{"version":3,"sources":["../../src/common/BasicModel.js"],"names":["BasicModel","loadEffect","modal","namespace","Error","basic","state","pager","current","pageSize","query","effects","loadData","action","select","put","type","changePager","search","payload","refresh","closeModal","modalName","reducers","onChangePager","onLoadData"],"mappings":"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","file":"BasicModel.js","sourcesContent":["import modelExtend from 'dva-model-extend';\nimport isObject from 'lodash/isObject';\n// Todo 处理withQuery参数, 还是保留冗余\nexport default function BasicModel(loadEffect, modal) {\n  if (!isObject(modal) || !modal.namespace) {\n    throw new Error('Modal must be an object with namespace');\n  }\n  const basic = {\n    state: {\n      pager: {\n        current: 1,\n        pageSize: 10,\n      },\n      query: {},\n    },\n    effects: {\n      * loadData(action, { select, put }) {\n        const query = yield select(state => state[modal.namespace].query);\n        const pager = yield select(state => state[modal.namespace].pager);\n        yield put({ type: loadEffect, query, pager });\n      },\n\n      * changePager({ pager }, { put }) {\n        yield put({ type: 'onChangePager', pager });\n        yield put({ type: 'loadData' });\n      },\n\n      * search({ query = {} }, { put, select }) {\n        const pageSize = yield select(state => state[modal.namespace].pager.pageSize);\n        yield put({ type: 'onLoadData', payload: { query, pager: { current: 1, pageSize } } });\n        yield put({ type: 'loadData' });\n      },\n\n      * refresh(action, { put }) {\n        yield put({ type: 'loadData' });\n      },\n\n      * closeModal(action, { put }) {\n        yield put({\n          type: 'onLoadData',\n          payload: {\n            modalName: '',\n          },\n        });\n      },\n    },\n    reducers: {\n      onChangePager(state, { pager }) {\n        return { ...state, pager };\n      },\n      onLoadData(state, action) {\n        return { ...state, ...action.payload };\n      },\n    },\n  };\n\n  return modelExtend(basic, modal);\n}\n"]}