{"version":3,"sources":["../../src/common/BasicModel.js"],"names":["BasicModel","loadEffect","modal","namespace","Error","basic","state","pager","current","pageSize","query","effects","loadData","action","select","put","type","changePager","search","payload","refresh","closeModal","modalName","reducers","onChangePager","onLoadData"],"mappings":"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","sourcesContent":["import modelExtend from 'dva-model-extend';\nimport isObject from 'lodash/isObject';\n// Todo 处理withQuery参数, 还是保留冗余\nexport default function BasicModel(loadEffect, modal) {\n  if (!isObject(modal) || !modal.namespace) {\n    throw new Error('Modal must be an object with namespace');\n  }\n  const basic = {\n    state: {\n      pager: {\n        current: 1,\n        pageSize: 10,\n      },\n      query: {},\n    },\n    effects: {\n      * loadData(action, { select, put }) {\n        const query = yield select(state => state[modal.namespace].query);\n        const pager = yield select(state => state[modal.namespace].pager);\n        yield put({ type: loadEffect, query, pager });\n      },\n\n      * changePager({ pager }, { put }) {\n        yield put({ type: 'onChangePager', pager });\n        yield put({ type: 'loadData' });\n      },\n\n      * search({ query = {} }, { put, select }) {\n        const pageSize = yield select(state => state[modal.namespace].pager.pageSize);\n        yield put({ type: 'onLoadData', payload: { query, pager: { current: 1, pageSize } } });\n        yield put({ type: 'loadData' });\n      },\n\n      * refresh(action, { put }) {\n        yield put({ type: 'loadData' });\n      },\n\n      * closeModal(action, { put }) {\n        yield put({\n          type: 'onLoadData',\n          payload: {\n            modalName: '',\n          },\n        });\n      },\n    },\n    reducers: {\n      onChangePager(state, { pager }) {\n        return { ...state, pager };\n      },\n      onLoadData(state, action) {\n        return { ...state, ...action.payload };\n      },\n    },\n  };\n\n  return modelExtend(basic, modal);\n}\n"],"file":"BasicModel.js"}